{% extends 'centroonline/base.html' %}

{% block title %}Home Build - Nuestros Proyectos{% endblock %}

{% block extra_head %}
<!-- SweetAlert2 CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="display-4 mb-3">Nuestros Proyectos</h1>
        <p class="lead">Descubre nuestras obras en desarrollo y proyectos finalizados</p>
        
        <!-- Filtros de estado -->
        <div class="btn-group btn-group-toggle mb-4" data-toggle="buttons">
            <a href="{% url 'proyectos' %}" class="btn btn-outline-secondary {% if not request.GET.estado %}active{% endif %}">
                Todos
            </a>
            <a href="?estado=PLANIFICACION" class="btn btn-outline-secondary {% if request.GET.estado == 'PLANIFICACION' %}active{% endif %}">
                Planificación
            </a>
            <a href="?estado=CONSTRUCCION" class="btn btn-outline-secondary {% if request.GET.estado == 'CONSTRUCCION' %}active{% endif %}">
                En construcción
            </a>
            <a href="?estado=FINALIZADO" class="btn btn-outline-secondary {% if request.GET.estado == 'FINALIZADO' %}active{% endif %}">
                Finalizados
            </a>
            <a href="?estado=ENTREGADO" class="btn btn-outline-secondary {% if request.GET.estado == 'ENTREGADO' %}active{% endif %}">
                Entregados
            </a>
        </div>
    </div>

    <div class="row">
        {% for proyecto in proyectos %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card project-card h-100" onclick="showProjectDetails({{ proyecto.id }})">
                <div class="position-relative">
                    <img src="{{ proyecto.imagen_principal.url }}" class="card-img-top project-img" alt="{{ proyecto.nombre }}">
                    <span class="status-badge 
                        {% if proyecto.estado == 'PLANIFICACION' %}status-planning
                        {% elif proyecto.estado == 'CONSTRUCCION' %}status-construction
                        {% elif proyecto.estado == 'FINALIZADO' %}status-finished
                        {% else %}status-delivered{% endif %}">
                        {{ proyecto.get_estado_display }}
                    </span>
                </div>
                <div class="card-body">
                    <h5 class="card-title">{{ proyecto.nombre }}</h5>
                    <p class="card-text">{{ proyecto.descripcion|truncatewords:20 }}</p>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <span class="budget-badge badge">
                            ${{ proyecto.presupuesto|floatformat:"0" }}
                        </span>
                        <small class="project-date">
                            <i class="fas fa-calendar-alt"></i> 
                            {{ proyecto.fecha_inicio|date:"M Y" }} - {{ proyecto.fecha_estimada_fin|date:"M Y" }}
                        </small>
                    </div>
                </div>
                <div class="card-footer bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>
                            <i class="fas fa-map-marker-alt location-icon"></i> 
                            {{ proyecto.ubicacion }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <img src="https://cdn-icons-png.flaticon.com/512/4076/4076478.png" style="width: 150px; opacity: 0.7;" class="mb-4">
            <h3 class="text-muted">No se encontraron proyectos</h3>
            <p class="text-muted">No hay proyectos que coincidan con tu selección</p>
            <a href="{% url 'proyectos' %}" class="btn btn-primary">Ver todos los proyectos</a>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Font Awesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<script>
    // Función para generar datos aleatorios de proyectos
    function getRandomProjectData(id) {
        const nombres = ["Proyecto A", "Proyecto B", "Proyecto C", "Proyecto D", "Proyecto E"];
        const ubicaciones = ["Madrid", "Barcelona", "Sevilla", "Valencia", "Zaragoza"];
        const descripciones = [
            "Descripción detallada del proyecto con todas sus características y especificaciones técnicas.",
            "Este proyecto tiene un enfoque innovador en el uso de tecnologías de construcción avanzada.",
            "El proyecto se centra en la eficiencia energética y la sostenibilidad a largo plazo.",
            "Con una fuerte inversión en infraestructura, este proyecto promete ser un hito en la industria.",
            "Un proyecto con una planificación meticulosa para garantizar su éxito."
        ];
        const estados = ["PLANIFICACION", "CONSTRUCCION", "FINALIZADO", "ENTREGADO"];
        const fechas = [
            "2023-01-15",
            "2023-05-10",
            "2023-09-20",
            "2024-02-01",
            "2024-07-15"
        ];
        const presupuestos = [1000000, 1250000, 1500000, 2000000, 2500000];

        const projectData = {
            id: id,
            nombre: nombres[Math.floor(Math.random() * nombres.length)],
            descripcion: descripciones[Math.floor(Math.random() * descripciones.length)],
            ubicacion: ubicaciones[Math.floor(Math.random() * ubicaciones.length)],
            fecha_inicio: fechas[Math.floor(Math.random() * fechas.length)],
            fecha_estimada_fin: fechas[Math.floor(Math.random() * fechas.length)],
            estado: estados[Math.floor(Math.random() * estados.length)],
            presupuesto: presupuestos[Math.floor(Math.random() * presupuestos.length)]
        };

        return projectData;
    }

    // Función para mostrar los detalles del proyecto con los datos aleatorios
    function showProjectDetails(projectId) {
        // Mostrar loader mientras se carga la información
        Swal.fire({
            title: 'Cargando proyecto...',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });
        
        // Generamos los datos del proyecto aleatoriamente
        setTimeout(() => {
            const projectData = getRandomProjectData(projectId);
            showProjectModal(projectData);
        }, 800);
    }

    // Función para mostrar el modal con los detalles del proyecto
    function showProjectModal(project) {
        Swal.fire({
            title: project.nombre,
            html: `
                <p><strong><i class="fas fa-map-marker-alt"></i> Ubicación:</strong> ${project.ubicacion}</p>
                <p><strong><i class="fas fa-calendar-alt"></i> Fecha inicio:</strong> ${new Date(project.fecha_inicio).toLocaleDateString()}</p>
                <p><strong><i class="fas fa-calendar-check"></i> Fecha estimada fin:</strong> ${new Date(project.fecha_estimada_fin).toLocaleDateString()}</p>
                <p><strong><i class="fas fa-money-bill-wave"></i> Presupuesto:</strong> $${parseFloat(project.presupuesto).toLocaleString()}</p>
                <p><strong><i class="fas fa-info-circle"></i> Descripción:</strong> ${project.descripcion}</p>
            `,
            width: '80%',
            showCloseButton: true,
            confirmButtonText: 'Cerrar'
        });
    }

    // Mostrar alerta de bienvenida
    document.addEventListener('DOMContentLoaded', function() {
        if (!sessionStorage.getItem('constructionWelcomeShown')) {
            Swal.fire({
                title: 'Bienvenido a Home Build',
                text: 'Explora nuestros proyectos de construcción innovadores',
                imageUrl: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60',
                imageWidth: 600,
                imageAlt: 'Proyectos de construcción',
                confirmButtonText: 'Explorar proyectos'
            });
            sessionStorage.setItem('constructionWelcomeShown', 'true');
        }
    });
</script>
{% endblock %}
