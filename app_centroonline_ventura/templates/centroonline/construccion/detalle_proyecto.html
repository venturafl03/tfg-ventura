{% extends 'centroonline/base.html' %}

{% block title %}{{ proyecto.nombre }} - Detalles{% endblock %}

{% block extra_head %}
<!-- Swiper CSS -->
<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
<!-- Animate.css -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<style>
    .project-header {
        background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('{{ proyecto.imagen_principal.url }}');
        background-size: cover;
        background-position: center;
        color: white;
        padding: 100px 0;
        margin-bottom: 50px;
    }
    .status-badge {
        font-size: 1rem;
        padding: 5px 15px;
        border-radius: 20px;
    }
    .status-planning {
        background-color: #6c757d;
        color: white;
    }
    .status-construction {
        background-color: #fd7e14;
        color: white;
    }
    .status-finished {
        background-color: #198754;
        color: white;
    }
    .status-delivered {
        background-color: #0d6efd;
        color: white;
    }
    .progress-container {
        height: 10px;
        background-color: #e9ecef;
        border-radius: 5px;
        margin: 20px 0;
    }
    .progress-bar {
        height: 100%;
        border-radius: 5px;
    }
    .gallery-thumbs .swiper-slide {
        opacity: 0.4;
        cursor: pointer;
    }
    .gallery-thumbs .swiper-slide-thumb-active {
        opacity: 1;
    }
    .info-card {
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }
    .info-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
    .location-icon {
        color: #dc3545;
    }
    .timeline {
        position: relative;
        padding-left: 30px;
    }
    .timeline::before {
        content: '';
        position: absolute;
        left: 10px;
        top: 0;
        bottom: 0;
        width: 2px;
        background: #0d6efd;
    }
    .timeline-item {
        position: relative;
        margin-bottom: 20px;
    }
    .timeline-item::before {
        content: '';
        position: absolute;
        left: -30px;
        top: 5px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #0d6efd;
        border: 3px solid white;
    }
    .budget-badge {
        font-size: 1.2rem;
        padding: 10px 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="project-header text-center animate__animated animate__fadeIn">
    <div class="container">
        <h1 class="display-4 mb-3">{{ proyecto.nombre }}</h1>
        <span class="status-badge 
            {% if proyecto.estado == 'PLANIFICACION' %}status-planning
            {% elif proyecto.estado == 'CONSTRUCCION' %}status-construction
            {% elif proyecto.estado == 'FINALIZADO' %}status-finished
            {% else %}status-delivered{% endif %}">
            {{ proyecto.get_estado_display }}
        </span>
    </div>
</div>

<div class="container mb-5">
    <div class="row">
        <div class="col-lg-8 animate__animated animate__fadeInLeft">
            <!-- Galería principal -->
            <div class="swiper gallery-main mb-3">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <img src="{{ proyecto.imagen_principal.url }}" class="img-fluid rounded" alt="Imagen principal">
                    </div>
                    {% for imagen in proyecto.imagenes.all %}
                    <div class="swiper-slide">
                        <img src="{{ imagen.imagen.url }}" class="img-fluid rounded" alt="{{ imagen.descripcion|default:'Imagen del proyecto' }}">
                        {% if imagen.descripcion %}
                        <p class="text-muted mt-2">{{ imagen.descripcion }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
            
            <!-- Galería thumbs -->
            <div class="swiper gallery-thumbs">
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <img src="{{ proyecto.imagen_principal.url }}" class="img-fluid rounded" alt="Thumbnail">
                    </div>
                    {% for imagen in proyecto.imagenes.all %}
                    <div class="swiper-slide">
                        <img src="{{ imagen.imagen.url }}" class="img-fluid rounded" alt="Thumbnail">
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Descripción -->
            <div class="card info-card mt-4">
                <div class="card-body">
                    <h3 class="card-title">Descripción del proyecto</h3>
                    <p class="card-text">{{ proyecto.descripcion }}</p>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 animate__animated animate__fadeInRight">
            <!-- Información del proyecto -->
            <div class="card info-card mb-4">
                <div class="card-body">
                    <h3 class="card-title">Detalles del proyecto</h3>
                    
                    <p><strong><i class="fas fa-map-marker-alt location-icon"></i> Ubicación:</strong><br>
                    {{ proyecto.ubicacion }}</p>
                    
                    <div class="d-flex justify-content-between mb-3">
                        <div>
                            <strong><i class="fas fa-calendar-alt"></i> Inicio:</strong><br>
                            {{ proyecto.fecha_inicio|date:"d M Y" }}
                        </div>
                        <div class="text-end">
                            <strong><i class="fas fa-calendar-check"></i> Fin estimado:</strong><br>
                            {{ proyecto.fecha_estimada_fin|date:"d M Y" }}
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-bar 
                            {% if proyecto.estado == 'PLANIFICACION' %}bg-secondary width-25
                            {% elif proyecto.estado == 'CONSTRUCCION' %}bg-warning width-65
                            {% elif proyecto.estado == 'FINALIZADO' %}bg-success width-90
                            {% else %}bg-primary width-100{% endif %}">
                        </div>
                    </div>
                    
                    <div class="text-center mt-3">
                        <span class="badge budget-badge bg-warning text-dark">
                            <i class="fas fa-money-bill-wave"></i> 
                            Presupuesto: ${{ proyecto.presupuesto|floatformat:"0" }}
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Cronograma -->
            <div class="card info-card mb-4">
                <div class="card-body">
                    <h3 class="card-title">Estado del proyecto</h3>
                    <div class="timeline">
                        <div class="timeline-item">
                            <h5>Planificación</h5>
                            <p class="text-muted">Diseño y preparación</p>
                            {% if proyecto.estado == 'PLANIFICACION' %}
                            <span class="badge bg-info">En progreso</span>
                            {% elif proyecto.estado != 'PLANIFICACION' %}
                            <span class="badge bg-success">Completado</span>
                            {% endif %}
                        </div>
                        <div class="timeline-item">
                            <h5>Construcción</h5>
                            <p class="text-muted">Ejecución de la obra</p>
                            {% if proyecto.estado == 'CONSTRUCCION' %}
                            <span class="badge bg-info">En progreso</span>
                            {% elif proyecto.estado == 'PLANIFICACION' %}
                            <span class="badge bg-secondary">Pendiente</span>
                            {% else %}
                            <span class="badge bg-success">Completado</span>
                            {% endif %}
                        </div>
                        <div class="timeline-item">
                            <h5>Finalizado</h5>
                            <p class="text-muted">Acabados y revisión</p>
                            {% if proyecto.estado == 'FINALIZADO' %}
                            <span class="badge bg-info">En progreso</span>
                            {% elif proyecto.estado in 'PLANIFICACION CONSTRUCCION' %}
                            <span class="badge bg-secondary">Pendiente</span>
                            {% else %}
                            <span class="badge bg-success">Completado</span>
                            {% endif %}
                        </div>
                        <div class="timeline-item">
                            <h5>Entregado</h5>
                            <p class="text-muted">Proyecto concluido</p>
                            {% if proyecto.estado == 'ENTREGADO' %}
                            <span class="badge bg-success">Completado</span>
                            {% else %}
                            <span class="badge bg-secondary">Pendiente</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Contacto -->
            <div class="card info-card">
                <div class="card-body text-center">
                    <h3 class="card-title">¿Interesado en este proyecto?</h3>
                    <p class="card-text">Contáctanos para más información</p>
                    <button class="btn btn-primary btn-lg w-100" onclick="showContactForm()">
                        <i class="fas fa-envelope"></i> Contactar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Swiper JS -->
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<!-- SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Font Awesome -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<script>
    // Inicializar galería de imágenes
    document.addEventListener('DOMContentLoaded', function() {
        const galleryThumbs = new Swiper('.gallery-thumbs', {
            spaceBetween: 10,
            slidesPerView: 4,
            freeMode: true,
            watchSlidesProgress: true,
        });
        
        const galleryMain = new Swiper('.gallery-main', {
            loop: true,
            spaceBetween: 10,
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            thumbs: {
                swiper: galleryThumbs,
            },
        });
        
        // Mostrar animación de carga inicial
        setTimeout(() => {
            const elements = document.querySelectorAll('.animate__animated');
            elements.forEach(el => {
                el.style.opacity = '1';
            });
        }, 100);
    });
    
    // Función para mostrar formulario de contacto
    function showContactForm() {
        Swal.fire({
            title: 'Contactar sobre este proyecto',
            html: `
                <form id="contactForm">
                    <div class="mb-3">
                        <input type="text" class="form-control" placeholder="Nombre completo" required>
                    </div>
                    <div class="mb-3">
                        <input type="email" class="form-control" placeholder="Correo electrónico" required>
                    </div>
                    <div class="mb-3">
                        <input type="tel" class="form-control" placeholder="Teléfono">
                    </div>
                    <div class="mb-3">
                        <textarea class="form-control" rows="4" placeholder="Mensaje" required></textarea>
                    </div>
                    <input type="hidden" value="{{ proyecto.nombre }}">
                </form>
            `,
            confirmButtonText: 'Enviar consulta',
            showCancelButton: true,
            cancelButtonText: 'Cancelar',
            preConfirm: () => {
                // Validar y enviar formulario
                return new Promise((resolve) => {
                    setTimeout(() => {
                        Swal.fire({
                            icon: 'success',
                            title: 'Consulta enviada',
                            text: 'Nos pondremos en contacto contigo pronto',
                            timer: 2000,
                            showConfirmButton: false
                        });
                        resolve();
                    }, 1000);
                });
            }
        });
    }
    
    // Mostrar alerta si el proyecto está finalizado
    {% if proyecto.estado == 'FINALIZADO' %}
    document.addEventListener('DOMContentLoaded', function() {
        Swal.fire({
            title: '¡Proyecto finalizado!',
            text: 'Este proyecto ha sido completado exitosamente',
            icon: 'success',
            confirmButtonText: 'Ver detalles',
            timer: 3000,
            timerProgressBar: true
        });
    });
    {% elif proyecto.estado == 'ENTREGADO' %}
    document.addEventListener('DOMContentLoaded', function() {
        Swal.fire({
            title: '¡Proyecto entregado!',
            text: 'Este proyecto ha sido entregado a sus propietarios',
            icon: 'info',
            confirmButtonText: 'Ver detalles',
            timer: 3000,
            timerProgressBar: true
        });
    });
    {% endif %}
</script>
{% endblock %}